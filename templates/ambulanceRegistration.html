{% include "header.html" %}
<div class="container Register-container shadow p-3 mb-5 bg-white rounded">
  <div class="row">
    <h1 class='fw-bolder ms-5 mb-4'>Ambulance Register</h1>
  </div>
  <div class="row">
<form action='/ambulanceregistration' method='POST'>
   <div class="form-group">
     <label >User Name</label>
     <input type="text" class="form-control"   placeholder="Enter username" name='username'>
     <small  class="form-text text-muted">We'll never share your info with anyone else.</small>
   </div>

   <div class="form-group">
     <label for="exampleInputPassword1">Password</label>
     <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password" name='password'>
   </div>

     <div class="form-group">
     <label for="exampleInputEmail1">Name</label>
     <input type="text" class="form-control"  name='name'>
   </div>

     <div class="form-group">
     <label for="exampleInputEmail1">Address</label>
     <input type="text" class="form-control"  name='address'>
   </div>

     <div class="form-group">
     <label for="exampleInputEmail1">Phone No</label>
     <input type="text" class="form-control"  name='phone'>
   </div>

   <div class="form-group">
      <div id="map"></div>
      <button type="button" class='btn btn-primary mt-3 mb-2' onclick="getLocation()">Get Live Location</button>
   </div>

   <div class="form-group">
      <label for="latitude">Latitude</label>
      <input type="text" class="form-control" placeholder="Enter Latitude" name="latitude" id="latitude" required>
    </div>

    <div class="form-group">
      <label for="longitude">Longitude</label>
      <input type="text" class="form-control" placeholder="Enter Longitude" name="longitude" id="longitude" required>
    </div>

   <button type="submit" class="btn btn-primary mb-3">Register</button>


 </form>
</div>

</div>




<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
  const x = document.getElementById("demo");
  let latitude = 21.538369;
  let longitude = 78.706055;
  var map;

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
    }
  }

  function showPosition(position) {
   latitude = position.coords.latitude;
   longitude = position.coords.longitude;
   console.log(latitude)
 
   var latitudeInput = document.getElementById("latitude");
   var longitudeInput = document.getElementById("longitude");
 
   if (latitudeInput && longitudeInput) {
     latitudeInput.value = latitude;
     longitudeInput.value = longitude;
   } else {
     console.error("Latitude or longitude input element not found.");
   }
 
   map.setView([latitude, longitude], 15); // Set map view to current location
 
   var marker = L.marker([latitude, longitude]).addTo(map); // Add marker at current location
   marker.bindPopup("Your Current Location").openPopup(); // Open a popup for the marker
   sendinfo(); // Send location info
 }

  var map = L.map('map').setView([latitude, longitude], 5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map);

  var popup = L.popup();

  function onMapClick(e) {
    popup
      .setLatLng(e.latlng)
      .setContent("You clicked this Location at " + e.latlng.toString())
      .openOn(map);
      document.getElementById("latitude").value = e.latlng;
    document.getElementById("longitude").value = e.latlng;

  }

  map.on('click', onMapClick);

  function sendinfo() {
    let userinfo = {
      'values': '' + latitude + ',' + longitude
    }
    const request = new XMLHttpRequest()
    request.open('POST', `/process/${JSON.stringify(userinfo)}`)
    request.onload = () => {
      const flaskMessage = request.responseText
      console.log(flaskMessage)
    }
    request.send()
  }
</script>

{% include "footer.html" %}